# 观察者模式

观察者(observe)模式: 一个`观察者(Observer)`和`被观察者(对象-Subject)`,二者关系是被观察者和观察者是一种一对多的依赖关系，只要是被观察者的状态发生改变，都会通知到观察者

# 观察者和发布/订阅区分图

[查看图片](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/5/9/163442ec1d6573c9~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp)

# 观察者模式例子

```javascript
class Subject {
	constructor() {
		this.observer = {}
	}
	// 添加观察者
	on(key, handle) {
		if (!(key in this.observer)) {
			this.observer[key] = []
		}
		this.observer[key].push(handle)
	}
	// 移除观察者
	off(key, handle) {
		const findIndex = this.observer[key].findIndex((item) => item === handle)
		if (findIndex < 0) {
			return false
		}
		this.observer[key].splice(findIndex, 1) // 下标，个数 ， 改变原数组 ， 返回删除的元素
		return false
	}
	// 通知所有观察者
	emit(key, ...rest) {
		this.observer[key].forEach((item) => {
			item.apply(this, rest)
		})
	}
}
const subject = new Subject()
// 被观察者   或者这样在包装一下也行
// + class Teacher {
// +    constructor() { }
// +   subscribe = function (key, func) {
// +       subject.on(key, func)
// +    }
// +   notify = function (key) {
// +        subject.emit(key)
// +    }
// +   remove = function (key, handle) {
// +       subject.off(key, handle)
// +   }
// + }
// 观察者
class Student {
	constructor(name) {
		this.name = name
	}
	notify() {
		console.log(this.name, "hello")
	}
}
// 使用
//  + const teacher = new Teacher()

const yyFn = function () {
	yy.notify()
}
const mmFn = function () {
	mm.notify()
}
const yy = new Student("yy")
const mm = new Student("mm")
// + teacher.subscribe('msg', () => {
// +     yy.notify()
// + })
// + teacher.subscribe(() => {
// +     mm.notify()
// + })
subject.on("msg", yyFn) // 添加观察者
subject.on("msg", mmFn) // 添加观察者

subject.emit("msg") // 通知所有观察者
subject.off("msg", mmFn) // 移除当前观察者
subject.emit("msg") // 通知所有观察者
```

# 参考链接

[设计模式之观察者模式/发布订阅模式](https://juejin.cn/post/6844903603107266567)
[观察者模式/发布订阅模式](https://juejin.cn/post/6844903513009422343)
