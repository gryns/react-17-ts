# 发布订阅模式

发布订阅有三部分组成，分为 Publisher(发布)、消息池(Topic)、Subscriber(订阅)组成。我们用的 vue 里的$on和$emit 就是发布订阅模式，还有 NodeJs 中 EventEmmiter。

# 实现思路

- 创建一个对象
- 在改对象上添加缓存列表(消息池)
- 创建 on 方法函数来订阅
- 创建 emit 方法函数来发布
- 创建 off 方法函数来取消订阅

# 例子

```javascript
class Publisher {
	constructor() {
		this.events = {}
	}
	// 订阅
	on(key, handle) {
		if (!this.events[key]) {
			this.events[key] = []
		}
		this.events[key].push(handle)
	}
	// 取消订阅
	off(key, handle) {
		if (this.events[key]) {
			const delIndex = this.events[key].findIndex((item) => item === handle)
			this.events[key].splice(delIndex, 1)
		}
	}
	// 发布
	emit(key) {
		if (this.events[key]) {
			this.events[key].forEach((element) => {
				element.call()
			})
		}
	}
}

const publish = new Publisher()
const jf = function () {
	console.log("jf--在打仗")
}
const wkl = function () {
	console.log("wkl--在打仗")
}
publish.on("wkl", wkl)

publish.on("wkl", jf)
publish.emit("wkl")
publish.off("wkl", wkl)
publish.emit("wkl")
```
