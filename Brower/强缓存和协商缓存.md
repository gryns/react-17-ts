# 浏览器中的强缓存和协商缓存

当我们访问一个网站时，浏览器会对一些资源进行缓存，当我们再次访问时，不在从服务器返回资源，而从缓存里获取资源来渲染页面，极大提高页面渲染速度和用户体验。

# 缓存的优点

- 减少服务器压力
- 减少网络带宽，减少重复请求
- 加快页面渲染

# 浏览器缓存分为：强缓存和协商缓存

强缓存是通过设置`expires`和`cache-control`来控制本地有效时间,浏览器会把资源放在`memory cache`或`disk cache`中。其中强缓存返回状态码`200`,协商缓存返回状态码`304`</br>
`expire`: 是`http1.0`版本表示的过期资源，它是一个绝对时间，由服务器返回，`expires`受本地时间限制，如果修改本地时间，会导致时间过期，

```javascript
// Response Headers 来源知乎
expires: Fri, 02 Jan 2000 00:00:00 GMT
```

`cache-control`:是`http1.1`版本，优先级大于`expires`,表示一个相对时间，请求头和响应头都支持设置。

```javascript
// Response Headers 来源知乎
cache-control: private, must-revalidate, no-cache, no-store, max-age=0
// Request Headers 来源知乎
cache-control: no-cache
```

- no-cache: 客户端缓存资源，但是是否缓存还需要协商缓存来验证。
- no-store: 不适用缓存
- max-age: 设置缓存时长（单位 s）
- private: 资源只有客户端可以缓存
- public: 可以被任何中间服务缓存，比如代理，CDN 等。

# 先后顺序

```javascript
cache - control > expires > Etag > last - modified
```

# 协商缓存

当某个资源没有被强缓存命中时，就会发一个请求到服务器，来验证协商缓存，如果缓存命中，http 返回状态码是`304(Not-Modified)`, 不返回资源。未命中，则返回资源。协商缓存利用的是`Last-Modified`、`If-Modified-Since`和`Etag`、`If-None-Match`这两对`Header`配置

- `Last-Modified`、`If-Modified-Since`：它俩是`http1.0`版本引入的，`Last-Modified`是服务器响应请求时，返回资源在服务器最后一次修改时间。`If-Modified-Since`是客户端再次发请求时，会带上上一次响应`Last-Modified`的时间，该字段保留的有最后一次修改文件的时间，服务器检查前后时间对比，是否有更新，有的话就返回新的资源，没有的话返回`304`
- `Etag`、`If-None-Match`：是`http1.1`版本，`Etag`是服务器端响应时，返回的唯一标识，有服务器生成，当客户端再次生成时，客户端在请求头里添加`If-None-Match`标识，值是`Etag`的值，服务器在拿到值`Etag`时，和本地做比较，不一致则返回最新资源

# 参考链接

[浏览器强缓存和协商缓存](https://juejin.cn/post/6947936223126093861)
